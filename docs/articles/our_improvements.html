<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Why improve the method from Cabaret &amp; Berrag (2004)? • FECR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Why improve the method from Cabaret &amp; Berrag (2004)?">
<meta property="og:description" content="FECR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FECR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">5.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/FECR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/our_improvements.html">Why improve the method from Cabaret &amp; Berrag (2004)?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="our_improvements_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Why improve the method from Cabaret &amp; Berrag (2004)?</h1>
            
      
      
      <div class="hidden name"><code>our_improvements.Rmd</code></div>

    </div>

    
    
<p>The motivation that led us to propose an improvement over the individual method proposed by the authors is that we identified the two pitfalls mentioned in the previous paragraph, i.e. the arbitrary pair-matching and requirement of an even sample-size.</p>
<p>Hereafter, we demonstrate the issue from the paper’s own toy example.</p>
<div id="epg-values-import" class="section level2">
<h2 class="hasAnchor">
<a href="#epg-values-import" class="anchor"></a>EPG values import</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FECR</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>

<span class="co"># Generate random EPG values, in the simple case of equal sample size</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">450</span>,<span class="fl">1250</span>,<span class="fl">1700</span>,<span class="fl">900</span>,<span class="fl">2550</span>,<span class="fl">500</span>,<span class="fl">750</span>,<span class="fl">850</span>,<span class="fl">500</span><span class="op">)</span>
<span class="va">T1.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">50</span>,<span class="fl">450</span>,<span class="fl">400</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>
<span class="va">T2.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">T2</span><span class="op">)</span>
<span class="va">C1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">750</span>,<span class="fl">600</span>,<span class="fl">500</span>,<span class="fl">700</span>,<span class="fl">1000</span>,<span class="fl">700</span>,<span class="fl">300</span>,<span class="fl">1250</span>,<span class="fl">1050</span><span class="op">)</span>
<span class="va">C1.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span>
<span class="va">C2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">540</span>,<span class="fl">400</span>,<span class="fl">1000</span>,<span class="fl">1750</span>,<span class="fl">350</span>,<span class="fl">600</span>,<span class="fl">900</span>,<span class="fl">550</span>,<span class="fl">450</span><span class="op">)</span>
<span class="va">C2.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C2</span><span class="op">)</span></code></pre></div>
</div>
<div id="fecr-calculations" class="section level2">
<h2 class="hasAnchor">
<a href="#fecr-calculations" class="anchor"></a>FECR calculations</h2>
<p>As expected, we find FECR values similar to what the authors report:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate random EPG values, in the simple case of equal sample size</span>
<span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.mean</span>,<span class="va">T2.mean</span>,method <span class="op">=</span> <span class="st">"Kochapakdee"</span><span class="op">)</span>            <span class="co"># 90% in the original paper</span></code></pre></div>
<pre><code>## [1] 89.94709</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1</span>,<span class="va">T2</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"Dash"</span><span class="op">)</span>                       <span class="co"># 90% in the original paper</span></code></pre></div>
<pre><code>## Warning in average_if_required(arg.list): a vector of epg has been provided in
## place of a mean. The arithmetic mean of the vector has been used.</code></pre>
<pre><code>## [1] 89.47058</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span>T2 <span class="op">=</span> <span class="va">T2.mean</span>,C2 <span class="op">=</span> <span class="va">C2.mean</span>,method <span class="op">=</span> <span class="st">"Coles"</span><span class="op">)</span>        <span class="co"># 86% in the original paper</span></code></pre></div>
<pre><code>## [1] 85.47401</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1</span>,<span class="va">T2</span>,method <span class="op">=</span> <span class="st">"Cabaret1"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>       <span class="co"># 83%(58-99%) in the original paper</span></code></pre></div>
<pre><code>## [1] 82.62164
## attr(,"CI")
##  lower.2.5% upper.97.5% 
##    60.00000    99.34641</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1</span>,<span class="va">T2</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># 84%(51-97%) in the original paper</span></code></pre></div>
<pre><code>## [1] 84.02088
## attr(,"CI")
##     2.5%    97.5% 
## 60.68754 98.28532</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1</span>,<span class="va">T2</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 75.37662
## attr(,"CI")
##     2.5%    97.5% 
## 63.61780 86.50022</code></pre>
<p>Our proposed method leads to a somewhat comparable value, albeit significantly lowered. We explain more on this hereafter.</p>
</div>
<div id="demonstration-of-the-pit-falls" class="section level2">
<h2 class="hasAnchor">
<a href="#demonstration-of-the-pit-falls" class="anchor"></a>Demonstration of the pit-falls</h2>
<div id="the-implicit-arbitrary-pair-matching" class="section level3">
<h3 class="hasAnchor">
<a href="#the-implicit-arbitrary-pair-matching" class="anchor"></a>The implicit arbitrary pair-matching</h3>
<p>The toy-example’s values only lead to the reported FECR when inputted in their specific order. Shuffling this order is enough to change the FECR value:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="co"># shuffling T and C</span>
<span class="va">new.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span><span class="op">)</span>
<span class="va">new.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span><span class="op">)</span>

<span class="va">T1.new</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
<span class="va">T2.new</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
<span class="va">C1.new</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
<span class="va">C2.new</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>

<span class="co"># Recalculating FECRs</span>
<span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 61.27418
## attr(,"CI")
##     2.5%    97.5% 
## 12.75385 98.14815</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 75.37662
## attr(,"CI")
##     2.5%    97.5% 
## 63.23173 85.67652</code></pre>
<p>Note that shuffling obviously has not change EPG distribution in T and C groups:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     450     500     850    1050    1250    2550</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">T1.new</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     450     500     850    1050    1250    2550</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">C2</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   350.0   450.0   550.0   726.7   900.0  1750.0</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">C2.new</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   350.0   450.0   550.0   726.7   900.0  1750.0</code></pre>
<p>And neither have methods based on group-averaged EPG</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Dash"</span><span class="op">)</span>                       <span class="co"># 90% in the original paper</span></code></pre></div>
<pre><code>## Warning in average_if_required(arg.list): a vector of epg has been provided in
## place of a mean. The arithmetic mean of the vector has been used.</code></pre>
<pre><code>## [1] 89.47058</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span>T2 <span class="op">=</span> <span class="va">T2.new</span>,C2 <span class="op">=</span> <span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Coles"</span><span class="op">)</span>        <span class="co"># 86% in the original paper</span></code></pre></div>
<pre><code>## Warning in average_if_required(arg.list): a vector of epg has been provided in
## place of a mean. The arithmetic mean of the vector has been used.</code></pre>
<pre><code>## [1] 85.47401</code></pre>
<p>More precisely, here is the bootstrapped distribution of the FECR value itself (not its confidence interval), across several reshuffling:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9000</span><span class="op">)</span>

<span class="co"># replicating the shuffling of T and C</span>
<span class="va">FECR.shuffled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">1000</span>,
  simplify <span class="op">=</span> <span class="cn">FALSE</span>,
  expr <span class="op">=</span> <span class="op">{</span>
    <span class="co"># shuffle</span>
    <span class="va">new.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">new.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">T1.new</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">T2.new</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">C1.new</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
    <span class="va">C2.new</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>

    <span class="co">#FECR calculations</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cabaret2"</span>,<span class="st">"MacIntosh1"</span><span class="op">)</span>,
      FECR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">.</span><span class="op">)</span>
<span class="va">FECR.shuffled</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FECR</span>,fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">method</span><span class="op">~</span><span class="va">.</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>,alpha <span class="op">=</span> <span class="fl">80</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">101</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="our_improvements_files/figure-html/pitfall%201%20details-1.png" width="700"></p>
<p>We can see that, depending on how individuals in T and C are paired, Cabaret &amp; Berrag’s method leads to a FECR drawn from a bimodal distribution.</p>
<p>Our method consistently leads to a single FECR value, close to the mean of this distribution:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">FECR.shuffled</span>,<span class="va">method</span> <span class="op">==</span> <span class="st">"MacIntosh1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">$</span><span class="va">FECR</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 75.37662</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">FECR.shuffled</span>,<span class="va">method</span> <span class="op">==</span> <span class="st">"Cabaret2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">$</span><span class="va">FECR</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 75.30635</code></pre>
</div>
<div id="uneven-sample-sizes" class="section level3">
<h3 class="hasAnchor">
<a href="#uneven-sample-sizes" class="anchor"></a>Uneven sample sizes</h3>
<p>Let’s simulate upon this toy example an uneven sample size between the T and C groups by randomly removing 2 individuals from one, e.g. T.</p>
<p>Since the <code>"Cabaret2"</code> method relies on a summation across n individuals in both the T and C groups, this requires subsetting the larger group too by randomly removing 2 individuals. This isn’t a requirement for our method, which will keep using all the individuals from C despite T having 2 individuals less.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9999</span><span class="op">)</span>
<span class="co"># removing 2 individuals from T and C</span>
<span class="va">new.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">new.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">T1.new</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
<span class="va">T2.new</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
<span class="va">C1.new</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
<span class="va">C2.new</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>

<span class="co"># Recalculating FECRs</span>
<span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 69.59653
## attr(,"CI")
##     2.5%    97.5% 
## 11.15497 99.47090</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in check_if_valid_parameters(arg.list): Some of T1,T2,C1,C2 are not of the same length.</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 79.13679
## attr(,"CI")
##     2.5%    97.5% 
## 64.90151 91.34628</code></pre>
<p>Again, if this is replicated many times, FECRs are impacted differently across the two methods:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">777</span><span class="op">)</span>

<span class="co"># replicating the shuffling of T and C</span>
<span class="va">FECR.minus.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">1000</span>,
  simplify <span class="op">=</span> <span class="cn">FALSE</span>,
  expr <span class="op">=</span> <span class="op">{</span>
    <span class="co"># shuffle</span>
    <span class="va">new.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>
    <span class="va">new.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>
    
    <span class="va">T1.new</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">T2.new</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">C1.new</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
    <span class="va">C2.new</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
    
    <span class="co">#FECR calculations</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cabaret2"</span>,<span class="st">"MacIntosh1"</span><span class="op">)</span>,
      FECR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1</span>,<span class="va">C2</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">.</span><span class="op">)</span>
<span class="va">FECR.minus.2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FECR</span>,fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">method</span><span class="op">~</span><span class="va">.</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>,alpha <span class="op">=</span> <span class="fl">80</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">101</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="our_improvements_files/figure-html/pitfall%202%20details-1.png" width="700"></p>
<p>Therefore, on top of using all the data available, our method also leads to more stable FECR values.</p>
</div>
<div id="what-about-confidence-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#what-about-confidence-intervals" class="anchor"></a>What about confidence intervals?</h3>
<p>The same processes of reshuffling or removing datapoints can be replicated to calculate the stability of confidence intervals’ boundaries:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>

<span class="co"># replicating the shuffling of T and C</span>
<span class="va">CI.shuffled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">100</span>,
  simplify <span class="op">=</span> <span class="cn">FALSE</span>,
  expr <span class="op">=</span> <span class="op">{</span>
    <span class="co"># shuffle</span>
    <span class="va">new.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">T1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">new.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">T1.new</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">T2.new</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span><span class="va">new.T</span><span class="op">]</span>
    <span class="va">C1.new</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
    <span class="va">C2.new</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span><span class="va">new.C</span><span class="op">]</span>
    <span class="va">Cab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,
                          compute.CI <span class="op">=</span> <span class="cn">TRUE</span>,pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">Mac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.new</span>,<span class="va">T2.new</span>,<span class="va">C1.new</span>,<span class="va">C2.new</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,
                          compute.CI <span class="op">=</span> <span class="cn">TRUE</span>,pb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

    <span class="co">#FECR calculations</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cabaret2"</span>,<span class="st">"MacIntosh1"</span><span class="op">)</span>,
      FECR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Cab</span>,<span class="va">Mac</span><span class="op">)</span>,
      lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Cab</span>,<span class="st">"CI"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Mac</span>,<span class="st">"CI"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
      <span class="op">)</span>,
      upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Cab</span>,<span class="st">"CI"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Mac</span>,<span class="st">"CI"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,<span class="va">.</span><span class="op">)</span>
<span class="va">CI.shuffled</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">method</span>,<span class="va">FECR</span>,colour <span class="op">=</span> <span class="va">method</span>,group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>,ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="our_improvements_files/figure-html/pitfall%20CI%20details-1.png" width="700"></p>
<p>Our proposed method is designed to calculate a FECR value (and its confidence interval) that is unique for a given set of EPG values in T and C groups. The only slight variations observed regarding the boundaries of the confidence interval is attributable to the bootstrap’s own random resampling.</p>
</div>
</div>
<div id="what-about-multiple-values-per-individual" class="section level2">
<h2 class="hasAnchor">
<a href="#what-about-multiple-values-per-individual" class="anchor"></a>What about multiple values per individual?</h2>
<p>None of the methods mentioned so far nor our fix of the Cabaret2 method handle multiple samples per individual. In this FECR package, we propose a non-parametric approach to include individual variability in the FECRs calculation.</p>
<div id="simulating-data" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-data" class="anchor"></a>Simulating data</h3>
<p>Here we simulate values for individuals of groups T and C, with different sample size per individual, group and period.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span>,quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/olafmersmann/truncnorm">truncnorm</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2001</span><span class="op">)</span>
<span class="co"># custom simulating function:</span>
<span class="va">sim_epg_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>,<span class="va">mean</span>,<span class="va">runif.boundaries</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
    <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># runif determine a random sample size per individual, and set the epg's sd to twice this</span>
      <span class="co"># value</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">runif.boundaries</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">runif.boundaries</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> 
        <span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/truncnorm/man/dtruncnorm.html">rtruncnorm</a></span><span class="op">(</span><span class="va">.</span>,mean <span class="op">=</span> <span class="va">mean</span>,sd <span class="op">=</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">2</span>,a <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> 
        <span class="va">round</span> <span class="op">%&gt;%</span> <span class="va">as.integer</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="co"># generating the data (generate list-column and unnest them for code brievity)</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span>,
                 epg <span class="op">=</span> <span class="fu">sim_epg_data</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>,mean <span class="op">=</span> <span class="fl">65</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="va">epg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span>,
                 epg <span class="op">=</span> <span class="fu">sim_epg_data</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>,mean <span class="op">=</span> <span class="fl">20</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="va">epg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span>
<span class="va">C1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>,
                 epg <span class="op">=</span> <span class="fu">sim_epg_data</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>,mean <span class="op">=</span> <span class="fl">70</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="va">epg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span>
<span class="va">C2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>,
                 epg <span class="op">=</span> <span class="fu">sim_epg_data</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>,mean <span class="op">=</span> <span class="fl">65</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="va">epg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span></code></pre></div>
<p>Note that ultimately, T1,T2,C1, and C2 now are data.frames (long format) containing column id (referring to the individual identity) and epg (the value per sample). In the future, we will implement ways for the user to specify the column names.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Treated"</span>,gp <span class="op">=</span> <span class="st">"T1"</span>,<span class="va">T1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Treated"</span>,gp <span class="op">=</span> <span class="st">"T2"</span>,<span class="va">T2</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Control"</span>,gp <span class="op">=</span> <span class="st">"C1"</span>,<span class="va">C1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Control"</span>,gp <span class="op">=</span> <span class="st">"C2"</span>,<span class="va">C2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gp</span>,<span class="va">epg</span>,colour <span class="op">=</span> <span class="va">id</span>,fill <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">group</span>,scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span>,fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Group per period (before = 1, after = 2)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="our_improvements_files/figure-html/data%20vis-1.png" width="700"></p>
</div>
<div id="fecr-values" class="section level3">
<h3 class="hasAnchor">
<a href="#fecr-values" class="anchor"></a>FECR values</h3>
<p>With such a dataset, one needs first to average epg values per individual (and possibly by group-period) before using any of the previously mentioned:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Treated"</span>,gp <span class="op">=</span> <span class="st">"T1"</span>,<span class="va">T1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Treated"</span>,gp <span class="op">=</span> <span class="st">"T2"</span>,<span class="va">T2</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Control"</span>,gp <span class="op">=</span> <span class="st">"C1"</span>,<span class="va">C1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Control"</span>,gp <span class="op">=</span> <span class="st">"C2"</span>,<span class="va">C2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">.</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epg</span><span class="op">)</span>,l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">epg</span>,<span class="fl">.025</span><span class="op">)</span>,u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">epg</span>,<span class="fl">.975</span><span class="op">)</span><span class="op">)</span>,by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">id</span>,<span class="va">group</span>,<span class="va">gp</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gp</span>,<span class="va">epg</span>,colour <span class="op">=</span> <span class="va">id</span>,fill <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">group</span>,scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">id</span><span class="op">)</span>,alpha <span class="op">=</span> <span class="fl">0.2</span>,colour <span class="op">=</span> <span class="st">"grey50"</span>,position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">l</span>,ymax <span class="op">=</span> <span class="va">u</span><span class="op">)</span>,position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>,position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span>,fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Group per period (before = 1, after = 2)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="our_improvements_files/figure-html/data%20sim%20FECR-1.png" width="700"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">T1.avg</span> <span class="op">&lt;-</span> <span class="va">T1</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epg</span><span class="op">)</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span><span class="op">$</span><span class="va">epg</span>;<span class="va">T2.avg</span> <span class="op">&lt;-</span> <span class="va">T2</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epg</span><span class="op">)</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span><span class="op">$</span><span class="va">epg</span>
<span class="va">C1.avg</span> <span class="op">&lt;-</span> <span class="va">C1</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epg</span><span class="op">)</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span><span class="op">$</span><span class="va">epg</span>;<span class="va">C2.avg</span> <span class="op">&lt;-</span> <span class="va">C2</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>epg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epg</span><span class="op">)</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">id</span><span class="op">]</span><span class="op">$</span><span class="va">epg</span>

<span class="co"># returns an error because of the uneven sample size</span>
<span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.avg</span>,<span class="va">T2.avg</span>,<span class="va">C1.avg</span>,<span class="va">C2.avg</span>,method <span class="op">=</span> <span class="st">"Cabaret2"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in check_if_valid_parameters(arg.list): Some of T1,T2,C1,C2 are not of the same length.</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1.avg</span>,<span class="va">T2.avg</span>,<span class="va">C1.avg</span>,<span class="va">C2.avg</span>,method <span class="op">=</span> <span class="st">"MacIntosh1"</span>,compute.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 60.1642
## attr(,"CI")
##     2.5%    97.5% 
## 58.69651 61.46585</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># expected FECR given the simulated epg means in the treated group:</span>
<span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">20</span> <span class="op">/</span> <span class="fl">65</span><span class="op">)</span> <span class="op">/</span>  <span class="op">(</span><span class="fl">65</span> <span class="op">/</span> <span class="fl">70</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.6686391</code></pre>
<p>We can see that, in this simulation, the FECR value after averaging per individual is lower and less variable than what could be expected by looking at the raw data and inputted mean epgs. Also, note that the confidence interval being so narrow, it does not contain the value 66% obtained through the inputted means.</p>
<p>In comparison, this is how our last method compares:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FECR.html">FECR</a></span><span class="op">(</span><span class="va">T1</span>,<span class="va">T2</span>,<span class="va">C1</span>,<span class="va">C2</span>,boot <span class="op">=</span> <span class="fl">500</span>,method <span class="op">=</span> <span class="st">"MacIntosh2"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 56.00778
## attr(,"CI")
##     2.5%    97.5% 
## 34.72859 71.85496</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># expected FECR given the simulated epg means in the treated group:</span>
<span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">20</span> <span class="op">/</span> <span class="fl">65</span><span class="op">)</span> <span class="op">/</span>  <span class="op">(</span><span class="fl">65</span> <span class="op">/</span> <span class="fl">70</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.6686391</code></pre>
<p>This last method, while returning a mean FECR lower than the one from the previous method, correctly reflects how variable individual epg data are in the dataset, by reprensenting the ditribution of FECR value one could have obtained given the individual variability. Note that this time, the “true” value 66% calculated through the group mean epgs is within the 95% interval.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kenneth Keuk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
